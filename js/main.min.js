const titleScreen=document.getElementById("title-screen"),startButton=document.getElementById("start-button"),loadingScreen=document.getElementById("loading-screen"),navToggle=document.getElementById("nav-toggle"),navMenu=document.getElementById("nav-menu"),navLinks=document.querySelectorAll(".nav-link"),mainNavigation=document.getElementById("main-navigation"),toggleThemeButton=document.getElementById("toggle-theme"),toggleSoundButton=document.getElementById("toggle-sound"),backgroundMusic=document.getElementById("background-music"),contactForm=document.getElementById("contact-form"),sections=document.querySelectorAll(".game-section");let soundEnabled=!0,currentTheme=localStorage.getItem("theme")||"light",loadingProgress=0,assets=[],currentSection=null,musicStarted=!1;function preloadAssets(){assets=["assets/images/avatar.jpg","assets/images/avatar-small.jpg","assets/images/pixel-character.png","assets/images/project1.jpg","assets/images/project2.jpg","assets/images/project3.jpg","assets/images/loading-icon.png","assets/images/grid-pattern.png","assets/sounds/button-click.mp3","assets/sounds/hover.mp3","assets/sounds/start.mp3"];const e=assets.length;let t=0;assets.forEach(n=>{const a=n.endsWith(".mp3")?new Audio:new Image;a.onload=a.oncanplaythrough=()=>{t++,loadingProgress=t/e*100,updateLoadingBar(),t===e&&setTimeout(completeLoading,500)},a.onerror=()=>{t++,console.warn(`Failed to load asset: ${n}`),t===e&&setTimeout(completeLoading,500)},n.endsWith(".mp3"),a.src=n}),setTimeout(completeLoading,5e3)}function updateLoadingBar(){document.querySelector(".loading-progress").style.width=`${loadingProgress}%`}function completeLoading(){document.querySelector(".loading-progress").style.width="100%",setTimeout(()=>{loadingScreen&&(loadingScreen.style.opacity="0"),setTimeout(()=>{loadingScreen&&(loadingScreen.style.display="none"),titleScreen&&titleScreen.classList.add("active");const e=document.querySelector(".game-title");e&&e.classList.add("fade-in");const t=document.querySelector(".game-subtitle");t&&t.classList.add("fade-in","delay-300");const n=document.querySelector(".pixel-character");n&&n.classList.add("fade-in","delay-500");const a=document.querySelector("#start-button");a&&a.classList.add("fade-in","delay-700");const o=document.querySelector(".blink-text");o&&o.classList.add("fade-in","delay-900")},500)},500)}function startGame(){playSound("start-sound");const e=document.getElementById("about")||document.getElementById("skills");e&&e.scrollIntoView({behavior:"smooth"})}function animateSectionEntrance(e){switch(e){case"about":animateElement(".character-avatar","slide-in-left"),animateElement(".character-info h3","slide-in-right",200),animateElement(".character-class","slide-in-right",300),animateElement(".character-stats","fade-in",400),animateElement(".character-bio","fade-in",600);break;case"skills":document.querySelectorAll(".skill-category").forEach((e,t)=>{e.classList.add("slide-in-bottom","delay-"+200*t)});break;case"projects":document.querySelectorAll(".project-card").forEach((e,t)=>{e.classList.add("fade-in","delay-"+200*t)});break;case"achievements":document.querySelectorAll(".achievement-card").forEach((e,t)=>{e.classList.add("slide-in-right","delay-"+150*t)});break;case"experience":document.querySelectorAll(".timeline-item").forEach((e,t)=>{e.classList.add("slide-in-left","delay-"+200*t)});break;case"contact":animateElement(".dialogue-box","slide-in-left"),animateElement(".contact-form","slide-in-right",300)}}function animateElement(e,t,n=0){const a=document.querySelector(e);a&&setTimeout(()=>{a.classList.add(t)},n)}function toggleTheme(){currentTheme="light"===currentTheme?"dark":"light",document.body.setAttribute("data-theme",currentTheme),localStorage.setItem("theme",currentTheme),updateThemeIcon(),playSound("click-sound")}function updateThemeIcon(){if(!toggleThemeButton)return;const e=toggleThemeButton.querySelector("i");e&&("light"===currentTheme?(e.className="fas fa-sun",toggleThemeButton.setAttribute("aria-pressed","false")):(e.className="fas fa-moon",toggleThemeButton.setAttribute("aria-pressed","true")))}function toggleSound(){console.log("Toggle sound clicked. Current state:",{soundEnabled:soundEnabled,musicStarted:musicStarted}),soundEnabled=!soundEnabled,updateSoundIcon(),soundEnabled?(playSound("click-sound"),!musicStarted&&backgroundMusic?(console.log("Starting background music via toggle..."),backgroundMusic.muted=!1,backgroundMusic.play().then(()=>{musicStarted=!0,console.log("BGM started via sound toggle")}).catch(e=>console.log("BGM play failed:",e))):backgroundMusic&&(console.log("Resuming background music via toggle..."),backgroundMusic.muted=!1,backgroundMusic.paused&&backgroundMusic.play().catch(e=>console.log("BGM resume failed:",e)))):backgroundMusic&&(console.log("Pausing background music via toggle..."),backgroundMusic.pause()),localStorage.setItem("soundEnabled",soundEnabled)}function startMusicOnFirstInteraction(){console.log("First interaction handler triggered",{soundEnabled:soundEnabled,musicStarted:musicStarted}),soundEnabled&&backgroundMusic&&!musicStarted?(console.log("Attempting to start music on first interaction..."),backgroundMusic.muted=!1,backgroundMusic.play().then(()=>{musicStarted=!0,console.log("Background music started on first user interaction")}).catch(e=>{console.log("Failed to start background music:",e)})):soundEnabled&&backgroundMusic&&musicStarted&&backgroundMusic.muted&&(backgroundMusic.muted=!1,console.log("Background music unmuted on first interaction"))}function addDeferredAudioStartHandlers(){["click","keydown","touchstart"].forEach(e=>{document.addEventListener(e,startMusicOnFirstInteraction,{once:!0,passive:!0})})}function updateSoundIcon(){if(!toggleSoundButton)return;const e=toggleSoundButton.querySelector("i");e&&(soundEnabled?(e.className="fas fa-volume-up",toggleSoundButton.setAttribute("aria-pressed","true")):(e.className="fas fa-volume-mute",toggleSoundButton.setAttribute("aria-pressed","false")))}function playSound(e){if(soundEnabled){const t=document.getElementById(e);t&&(t.currentTime=0,t.play().catch(e=>{console.warn("Audio playback was prevented:",e)}))}}function addHoverSoundToButtons(){document.querySelectorAll(".game-button, .menu-button, .back-button, .dialogue-option, .nav-link, .nav-toggle").forEach(e=>{e.addEventListener("mouseenter",()=>{playSound("hover-sound")})})}function handleContactFormSubmit(e){e.preventDefault();const t=document.getElementById("name"),n=document.getElementById("email"),a=document.getElementById("message");t.value&&n.value&&a.value?(playSound("click-sound"),emailjs.send("service_uqc89hm","template_e73u9a5",{name:t.value,email:n.value,message:a.value}).then(function(e){console.log("EmailJS SUCCESS!",e.status,e.text),contactForm.innerHTML=`\n            <div class="success-message">\n                <h3>Message Sent!</h3>\n                <p>Thank you for your message, ${t.value}. I'll get back to you soon!</p>\n                <button type="button" class="game-button" onclick="showSection('main-menu')">Return to Menu</button>\n            </div>\n        `;const n=document.querySelector(".success-message");n&&n.classList.add("fade-in")},function(e){console.error("EmailJS FAILED...",e),alert("Failed to send message. Error: "+JSON.stringify(e))})):alert("Please fill in all fields")}function initCustomCursor(){const e=document.createElement("div");e.className="custom-cursor",document.body.appendChild(e),document.addEventListener("mousemove",t=>{e.style.left=`${t.clientX}px`,e.style.top=`${t.clientY}px`}),document.addEventListener("mousedown",()=>{e.classList.add("active")}),document.addEventListener("mouseup",()=>{e.classList.remove("active")}),document.addEventListener("mouseleave",()=>{e.style.display="none"}),document.addEventListener("mouseenter",()=>{e.style.display="block"});document.querySelectorAll("a, button, input, textarea, .project-card, .dialogue-option").forEach(t=>{t.addEventListener("mouseenter",()=>{e.classList.add("active")}),t.addEventListener("mouseleave",()=>{e.classList.remove("active")})})}function setupScrollAnimations(){const e=document.querySelectorAll('[data-animation="hidden"]'),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.setAttribute("data-animation","visible"),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{t.observe(e)})}function initSideNoteToggle(){const e=document.querySelector(".side-note"),t=document.querySelector(".side-note-toggle");if(!e||!t)return;if("true"===localStorage.getItem("sideNoteMinimized")){e.classList.add("minimized"),t.setAttribute("aria-expanded","false");const n=t.querySelector("i");n&&(n.className="fas fa-plus"),t.title="Expand",t.setAttribute("aria-label","Expand note")}t.addEventListener("click",()=>{const n=!e.classList.contains("minimized");e.classList.toggle("minimized"),localStorage.setItem("sideNoteMinimized",String(n)),t.setAttribute("aria-expanded",String(!n));const a=t.querySelector("i");a&&(a.className=n?"fas fa-plus":"fas fa-minus"),t.title=n?"Expand":"Minimize",t.setAttribute("aria-label",n?"Expand note":"Minimize note"),playSound("click-sound")})}function createAnchoredDecorations(){const e=["assets/images/confetti-images/1.png","assets/images/confetti-images/2.png","assets/images/confetti-images/3.png","assets/images/confetti-images/4.png","assets/images/confetti-images/5.png","assets/images/confetti-images/6.png","assets/images/confetti-images/7.png","assets/images/confetti-images/8.png","assets/images/confetti-images/9.png","assets/images/confetti-images/10.png","assets/images/confetti-images/11.png","assets/images/confetti-images/12.png"],t=["assets/images/confetti-images/1.gif","assets/images/confetti-images/2.gif","assets/images/confetti-images/3.gif","assets/images/confetti-images/4.gif","assets/images/confetti-images/5.gif","assets/images/confetti-images/6.gif","assets/images/confetti-images/7.gif","assets/images/confetti-images/8.gif","assets/images/confetti-images/9.gif","assets/images/confetti-images/10.gif"],n=document.querySelectorAll(".game-section"),a=["variant-1","variant-2","variant-3","variant-4"],o=["size-small","size-medium","size-large"];n.forEach((n,s)=>{"static"===getComputedStyle(n).position&&(n.style.position="relative");const i=Math.floor(2*Math.random())+2;for(let t=0;t<i;t++){const t=document.createElement("div");t.className="anchored-decoration animated";const s=e[Math.floor(Math.random()*e.length)];t.style.backgroundImage=`url('${s}')`;const i=a[Math.floor(Math.random()*a.length)],c=o[Math.floor(Math.random()*o.length)];t.classList.add(i,c),t.style.left=80*Math.random()+10+"%",t.style.top=70*Math.random()+15+"%",n.appendChild(t)}const c=Math.floor(2*Math.random())+1;for(let e=0;e<c;e++){const e=document.createElement("div");e.className="anchored-decoration static";const a=t[Math.floor(Math.random()*t.length)];e.style.backgroundImage=`url('${a}')`;const s=o[Math.floor(Math.random()*o.length)];e.classList.add(s),e.style.right=80*Math.random()+10+"%",e.style.bottom=70*Math.random()+15+"%",n.appendChild(e)}})}function showSection(e){const t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth"})}function setupNavigation(){navToggle&&navMenu&&navToggle.addEventListener("click",()=>{const e="true"===navToggle.getAttribute("aria-expanded");navToggle.setAttribute("aria-expanded",!e),navMenu.classList.toggle("active"),playSound("click-sound")}),navLinks.forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("href")||"",a=n.startsWith("#");if(playSound("click-sound"),navMenu&&navMenu.classList.contains("active")&&(navMenu.classList.remove("active"),navToggle.setAttribute("aria-expanded","false")),a){t.preventDefault();const e=n.substring(1),a=document.getElementById(e);a&&a.scrollIntoView({behavior:"smooth",block:"start"})}})}),document.addEventListener("click",e=>{navMenu&&navMenu.classList.contains("active")&&!navMenu.contains(e.target)&&!navToggle.contains(e.target)&&(navMenu.classList.remove("active"),navToggle.setAttribute("aria-expanded","false"))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&navMenu&&navMenu.classList.contains("active")&&(navMenu.classList.remove("active"),navToggle.setAttribute("aria-expanded","false"))})}function setupNavigationScrollEffect(){let e=window.scrollY;window.addEventListener("scroll",()=>{const t=window.scrollY;t>50?mainNavigation.classList.add("scrolled"):mainNavigation.classList.remove("scrolled"),updateActiveNavLink(),e=t})}function updateActiveNavLink(){const e=window.scrollY+100;sections.forEach(t=>{const n=t.offsetTop,a=t.offsetHeight,o=t.getAttribute("id");if(e>=n&&e<n+a){navLinks.forEach(e=>e.classList.remove("active"));const e=document.querySelector(`.nav-link[href="#${o}"]`);e&&e.classList.add("active")}})}function initAvatarVisualizer(){const e=document.getElementById("avatar-visualizer");if(!e)return;const t=backgroundMusic;if(!t)return;const n=e.getContext("2d");let a,o,s,i,c;function d(){const t=window.devicePixelRatio||1;a=e.clientWidth*t,o=e.clientHeight*t,e.width=a,e.height=o,s=a/2,i=o/2,c=.32*Math.min(a,o)}d(),window.addEventListener("resize",d);const l=window.AudioContext||window.webkitAudioContext;let r=null,u=null,m=null,g=null,f=!1;function h(){if(!f&&l)try{r=new l,u=r.createAnalyser(),u.fftSize=256,m=r.createMediaElementSource(t),m.connect(u),u.connect(r.destination),g=new Uint8Array(u.frequencyBinCount),f=!0}catch(e){console.warn("Visualizer audio graph failed:",e)}}t.addEventListener("play",()=>{f||h(),r&&"suspended"===r.state&&r.resume().catch(()=>{})}),t.paused||h();let p=null,v=null;const y=[];function b(e,t){return y[e]=null==y[e]?t:.6*y[e]+.4*t,y[e]}!function e(){if(requestAnimationFrame(e),!f)return;u.getByteFrequencyData(g),n.clearRect(0,0,a,o),n.save(),n.translate(s,i);const t=Math.floor(g.length/96),d=.25*c,l=function(){const e=a+"x"+o+"_"+document.body.getAttribute("data-theme");return v&&e===p||(p=e,v=n.createLinearGradient(0,0,a,o),"dark"===document.body.getAttribute("data-theme")?(v.addColorStop(0,"#bb86fc"),v.addColorStop(1,"#03dac6")):(v.addColorStop(0,"#5d34af"),v.addColorStop(1,"#3e8948"))),v}();n.lineCap="round";for(let e=0;e<96;e++){const a=g[e*t]/255,o=b(e,a*a),s=4+o*d,i=e/96*Math.PI*2,r=Math.cos(i),u=Math.sin(i),m=r*c,f=u*c,h=r*(c+s),p=u*(c+s);n.strokeStyle=l;const v="dark"===document.body.getAttribute("data-theme"),y=v?.35:.5,S=v?.65:.85;n.globalAlpha=y+o*S,n.beginPath(),n.moveTo(m,f),n.lineTo(h,p),n.lineWidth=1.5+2.5*o,n.stroke()}n.restore()}()}document.addEventListener("DOMContentLoaded",()=>{document.body.setAttribute("data-theme",currentTheme),updateThemeIcon();const e=localStorage.getItem("soundEnabled");null!==e&&(soundEnabled="true"===e,updateSoundIcon()),backgroundMusic&&(backgroundMusic.muted=!0,console.log("Background music initialized:",{src:backgroundMusic.src,muted:backgroundMusic.muted,autoplay:backgroundMusic.autoplay,loop:backgroundMusic.loop,soundEnabled:soundEnabled})),soundEnabled&&backgroundMusic&&(console.log("Attempting to start background music...",{soundEnabled:soundEnabled,musicStarted:musicStarted}),setTimeout(()=>{console.log("Background music element:",backgroundMusic,"Muted:",backgroundMusic.muted),backgroundMusic.play().then(()=>{musicStarted=!0,console.log("Background music started automatically")}).catch(e=>{console.log("Auto-play prevented by browser, will start on first user interaction:",e),addDeferredAudioStartHandlers()})},500)),preloadAssets(),setTimeout(createAnchoredDecorations,1e3),startButton&&startButton.addEventListener("click",startGame),document.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),startGame())}),setupNavigation(),toggleThemeButton&&toggleThemeButton.addEventListener("click",toggleTheme),toggleSoundButton&&toggleSoundButton.addEventListener("click",toggleSound),setupNavigationScrollEffect(),contactForm&&contactForm.addEventListener("submit",handleContactFormSubmit),addHoverSoundToButtons(),window.innerWidth>768&&initCustomCursor(),setupScrollAnimations(),initAvatarVisualizer()}),document.addEventListener("DOMContentLoaded",()=>{emailjs.init("nju6MOa-L6VA2UZ7Y");const e=document.getElementById("contact-form");e&&e.addEventListener("submit",handleContactFormSubmit)}),document.addEventListener("keydown",e=>{const t=document.activeElement;if((!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable)&&"main-menu"===currentSection){const t=document.querySelectorAll(".menu-button");let n=-1;t.forEach((e,t)=>{document.activeElement===e&&(n=t)}),"ArrowUp"===e.key&&(e.preventDefault(),n>0?(t[n-1].focus(),playSound("hover-sound")):(t[t.length-1].focus(),playSound("hover-sound"))),"ArrowDown"===e.key&&(e.preventDefault(),n<t.length-1?(t[n+1].focus(),playSound("hover-sound")):(t[0].focus(),playSound("hover-sound"))),"Enter"===e.key&&-1!==n&&(e.preventDefault(),t[n].click())}}),window.addEventListener("resize",()=>{const e=document.querySelector(".custom-cursor");window.innerWidth<=768&&e?e.style.display="none":window.innerWidth>768&&e&&(e.style.display="block")}),function(){const e=document.querySelector(".side-note"),t=document.getElementById("side-note-timer-bar");if(!e||!t)return;let n=null,a=null;function o(){e.classList.remove("hidden"),t.style.width="100%",a=performance.now(),requestAnimationFrame(function n(o){const s=o-a,i=Math.min(1,s/2e4);if(t.style.width=100*(1-i)+"%",i<1)requestAnimationFrame(n);else{e.classList.add("hidden"),e.classList.add("minimized");const t=e.querySelector(".side-note-toggle");if(t){t.setAttribute("aria-expanded","false");const e=t.querySelector("i");e&&(e.className="fas fa-plus")}}}),clearTimeout(n),n=setTimeout(()=>{e.classList.add("hidden")},20500)}"true"!==localStorage.getItem("sideNoteMinimized")&&setTimeout(o,700);const s=e.querySelector(".side-note-toggle");s&&s.addEventListener("click",()=>{e.classList.contains("minimized")?(clearTimeout(n),t.style.width="100%"):(o(),e.classList.remove("hidden"),localStorage.setItem("sideNoteMinimized","false"))})}(),window.GameUI={playSound:playSound,showSection:showSection,toggleTheme:toggleTheme,toggleSound:toggleSound};